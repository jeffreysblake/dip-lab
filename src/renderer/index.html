<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>DIP Lab</title>
    <link rel="stylesheet" href="./shared-styles.css">
    <style>
        /* Main layout specific styles */
        body {
            font-family: var(--font-primary);
            margin: 0;
            padding: 0;
            display: flex;
            height: 100vh;
            background-color: var(--color-background);
            color: var(--color-text);
        }
        .sidebar {
            width: 200px;
            background-color: var(--color-sidebar-bg);
            color: var(--color-sidebar-text);
            padding: 20px 0;
            height: 100%;
            box-sizing: border-box;
            border-right: 1px solid var(--color-neutral-dark);
        }
        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background-color: var(--color-background);
        }
        .nav-item {
            display: block;
            color: var(--color-sidebar-text);
            padding: 12px 20px;
            text-decoration: none;
            margin: 5px 0;
            transition: background-color 0.3s;
            border-radius: 4px;
            margin: 5px 10px;
        }
        .nav-item:hover {
            background-color: var(--color-sidebar-hover);
        }
        .nav-item.active {
            background-color: var(--color-primary);
            color: white;
        }
        .view-content {
            background-color: var(--color-card-bg);
            padding: 20px;
            border-radius: var(--component-border-radius);
            box-shadow: var(--component-shadow);
            margin-top: 20px;
            border: 1px solid var(--color-neutral);
        }
        h1 {
            color: var(--color-text);
            text-align: center;
            font-family: var(--font-heading);
        }
        h3 {
            color: var(--color-sidebar-text);
            margin-top: 0;
        }
        .content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .panel {
            background-color: var(--color-panel-bg);
            border: 1px solid var(--color-neutral);
            border-radius: var(--component-border-radius);
            padding: var(--component-padding);
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <h3 style="padding-left: 20px; margin-top: 0;">Navigation</h3>
        <a href="#" class="nav-item" onclick="loadView('spatial')">Spatial</a>
        <a href="#" class="nav-item" onclick="loadView('frequency')">Frequency</a>
        <a href="#" class="nav-item" onclick="loadView('projection')">Projection</a>
        <a href="#" class="nav-item" onclick="loadView('blurDetection')">Blur Detection</a>
    </div>
    
    <div class="main-content">
        <div id="view-container">
            <!-- Views will be loaded here dynamically -->
            <div class="content">
                <div class="panel">
                    <h2>Application Status</h2>
                    <p>This is the main application window for the DIP Electron application.</p>
                    <p id="status">Loading...</p>
                </div>
                
                <div class="panel">
                    <h2>Controls</h2>
                    <button onclick="window.location.href='about:blank'">Test Button</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // This script will be executed in the renderer process
        document.addEventListener('DOMContentLoaded', () => {
            const statusElement = document.getElementById('status');
            try {
                // In a real app, you might check if main process is available
                statusElement.textContent = 'Application loaded successfully';
                // Load spatial view by default when the application starts
                loadView('spatial');
            } catch (error) {
                statusElement.textContent = `Error: ${error.message}`;
            }
        });
        
        
        function loadView(viewName) {
            const container = document.getElementById('view-container');

            // Clear the current content and add new view content
            const viewMap = {
                'spatial': './views/spatial.html',
                'frequency': './views/frequency.html',
                'projection': './views/projection.html',
                'blurDetection': './views/blurDetection.html'
            };
            const viewPath = viewMap[viewName] || './views/spatial.html';
            fetch(viewPath)
                .then(response => response.text())
                .then(htmlContent => {
                    container.innerHTML = htmlContent;
                    // Execute any JavaScript in the loaded HTML if needed
                    const scripts = container.querySelectorAll('script');
                    scripts.forEach(script => {
                        const newScript = document.createElement('script');
                        newScript.textContent = script.textContent;
                        // Avoid duplicate variable declarations by using a wrapper function
                        // Check for common problematic patterns that cause redeclaration errors
                        const imgPattern = /(?:const|let|var)\s+img\s*=.*;/;
                        if (imgPattern.test(newScript.textContent)) {
                            // Wrap the entire content in an IIFE to prevent scope issues
                            // Only wrap if it's not already wrapped to avoid double wrapping
                            if (!newScript.textContent.trim().startsWith('(function() {')) {
                                try {
                                    newScript.textContent = `(function() {
                                        ${newScript.textContent}
                                    })();`;
                                } catch (wrapError) {
                                    console.warn("Failed to wrap script content:", wrapError);
                                    // If wrapping fails, execute as-is but with proper error handling
                                    // Also add a safety check for image loading paths in the wrapped code
                                }
                            }
                        }
                        try {
                            document.head.appendChild(newScript);
                        } catch (error) {
                            console.error("Error executing script:", error);
                        }
                    });
                })
                .catch(error => {
                    console.error('Error loading view:', error);
                    container.innerHTML = `<div class="view-content"><h2>View</h2><p>Error loading content: ${error.message}</p></div>`;
                });
        }
    </script>
</body>
</html>